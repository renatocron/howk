apiVersion: v1
kind: ConfigMap
metadata:
  name: howk-config
  namespace: howk
data:
  config.yaml: |
    api:
      port: 8080
      read_timeout: 10s
      write_timeout: 10s
      max_request_size: 1048576  # 1MB

    kafka:
      brokers:
        - redpanda:9092
      topics:
        pending: howk.pending
        results: howk.results
        deadletter: howk.deadletter
        scripts: howk.scripts
        slow: howk.slow
        state: howk.state
      consumer_group: howk-workers
      retention: 168h
      producer_batch_size: 16384
      producer_linger_ms: 50
      producer_compression: snappy
      consumer_fetch_min_bytes: 1
      consumer_fetch_max_wait: 500ms
      group_session_timeout: 10s
      group_heartbeat_interval: 3s
      group_rebalance_timeout: 60s

    redis:
      addr: redis:6379
      password: ""
      db: 0
      pool_size: 100
      min_idle_conns: 10
      dial_timeout: 5s
      read_timeout: 3s
      write_timeout: 3s

    delivery:
      timeout: 30s
      max_idle_conns: 100
      max_conns_per_host: 10
      idle_conn_timeout: 90s
      tls_handshake_timeout: 10s
      user_agent: "HOWK/1.0"

    retry:
      base_delay: 10s
      max_delay: 24h
      max_attempts: 20
      jitter: 0.2

    circuit_breaker:
      failure_threshold: 5
      failure_window: 60s
      recovery_timeout: 5m
      probe_interval: 60s
      success_threshold: 2

    scheduler:
      poll_interval: 1s
      batch_size: 500
      lock_timeout: 30s

    concurrency:
      max_inflight_per_endpoint: 50
      inflight_ttl: 60s
      slow_lane_rate: 10  # messages per second

    ttl:
      circuit_state_ttl: 24h
      status_ttl: 168h
      stats_ttl: 48h
      idempotency_ttl: 24h
      retry_data_ttl: 48h

    lua:
      enabled: false
      timeout: 500ms
      memory_limit_mb: 50
      allowed_hosts:
        - "*"
      http_timeout: 5s
      kv_ttl_default: 24h
