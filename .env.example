# HOWK Configuration via Environment Variables
# Copy to .env and modify as needed
# All env vars are prefixed with HOWK_ and use nested structure with underscores
# Example: HOWK_KAFKA_BROKERS, HOWK_REDIS_ADDR, etc.

# API Configuration
HOWK_API_PORT=8080
HOWK_API_READ_TIMEOUT=10s
HOWK_API_WRITE_TIMEOUT=10s
HOWK_API_MAX_REQUEST_SIZE=1048576

# Kafka Configuration
HOWK_KAFKA_BROKERS=localhost:19092
HOWK_KAFKA_TOPICS_PENDING=howk.pending
HOWK_KAFKA_TOPICS_RESULTS=howk.results
HOWK_KAFKA_TOPICS_DEADLETTER=howk.deadletter
HOWK_KAFKA_CONSUMER_GROUP=howk-workers
HOWK_KAFKA_RETENTION=168h
HOWK_KAFKA_PRODUCER_BATCH_SIZE=16384
HOWK_KAFKA_PRODUCER_LINGER_MS=50
HOWK_KAFKA_PRODUCER_COMPRESSION=snappy
HOWK_KAFKA_CONSUMER_FETCH_MIN_BYTES=1
HOWK_KAFKA_CONSUMER_FETCH_MAX_WAIT=500ms
HOWK_KAFKA_GROUP_SESSION_TIMEOUT=10s
HOWK_KAFKA_GROUP_HEARTBEAT_INTERVAL=3s
HOWK_KAFKA_GROUP_REBALANCE_TIMEOUT=10s

# Redis Configuration
HOWK_REDIS_ADDR=localhost:6379
HOWK_REDIS_PASSWORD=
HOWK_REDIS_DB=0
HOWK_REDIS_POOL_SIZE=100
HOWK_REDIS_MIN_IDLE_CONNS=10
HOWK_REDIS_DIAL_TIMEOUT=5s
HOWK_REDIS_READ_TIMEOUT=3s
HOWK_REDIS_WRITE_TIMEOUT=3s

# Delivery Configuration
HOWK_DELIVERY_TIMEOUT=30s
HOWK_DELIVERY_MAX_IDLE_CONNS=100
HOWK_DELIVERY_MAX_CONNS_PER_HOST=10
HOWK_DELIVERY_IDLE_CONN_TIMEOUT=90s
HOWK_DELIVERY_TLS_HANDSHAKE_TIMEOUT=10s
HOWK_DELIVERY_USER_AGENT=HOWK/1.0

# Retry Configuration
HOWK_RETRY_BASE_DELAY=10s
HOWK_RETRY_MAX_DELAY=24h
HOWK_RETRY_MAX_ATTEMPTS=20
HOWK_RETRY_JITTER=0.2

# Circuit Breaker Configuration
HOWK_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
HOWK_CIRCUIT_BREAKER_FAILURE_WINDOW=60s
HOWK_CIRCUIT_BREAKER_RECOVERY_TIMEOUT=5m
HOWK_CIRCUIT_BREAKER_PROBE_INTERVAL=60s
HOWK_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# Scheduler Configuration
HOWK_SCHEDULER_POLL_INTERVAL=1s
HOWK_SCHEDULER_BATCH_SIZE=500
HOWK_SCHEDULER_LOCK_TIMEOUT=30s

# TTL Configuration (Redis key expiration times)
HOWK_TTL_CIRCUIT_STATE_TTL=24h
HOWK_TTL_STATUS_TTL=168h
HOWK_TTL_STATS_TTL=48h
HOWK_TTL_IDEMPOTENCY_TTL=24h

# Lua Script Engine Configuration
HOWK_LUA_ENABLED=false
HOWK_LUA_TIMEOUT=500ms
HOWK_LUA_MEMORY_LIMIT_MB=50
HOWK_LUA_KV_TTL_DEFAULT=24h

# Lua HTTP Module Configuration
# Global allowlist - comma-separated hostnames, supports wildcards like *.example.com
HOWK_LUA_ALLOWED_HOSTS=*
HOWK_LUA_HTTP_TIMEOUT=5s
HOWK_LUA_HTTP_CACHE_ENABLED=true
HOWK_LUA_HTTP_CACHE_TTL=5m

# Namespace-specific HTTP allowlists (override global for that namespace)
# Format: HOWK_LUA_ALLOW_HOSTNAME_{NAMESPACE}=host1,host2
# Example for config_id "music:123" (namespace is "music"):
# HOWK_LUA_ALLOW_HOSTNAME_MUSIC="api.music.com,auth.music.com"
# HOWK_LUA_ALLOW_HOSTNAME_PAYMENT="api.stripe.com,api.paypal.com"

# Lua Crypto Keys (dynamic naming: HOWK_LUA_CRYPTO_{KEY_NAME})
# These are PEM-encoded RSA private keys used for decrypting credentials in Lua scripts.
# The key suffix (e.g., PRIMARY, SECONDARY) is used in Lua: crypto.decrypt_credential("PRIMARY", ...)
# Supports both PKCS1 (-----BEGIN RSA PRIVATE KEY-----) and PKCS8 (-----BEGIN PRIVATE KEY-----) formats.
# IMPORTANT: The entire PEM content must be on a single line with \n for newlines, or use actual newlines.
#
# Example with single-line format:
# HOWK_LUA_CRYPTO_PRIMARY="-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEA...\n-----END RSA PRIVATE KEY-----"
#
# Example loading from file in shell:
# export HOWK_LUA_CRYPTO_PRIMARY="$(cat /etc/howk/keys/primary.pem)"

# Kafka Scripts Topic
HOWK_KAFKA_TOPICS_SCRIPTS=howk.scripts
